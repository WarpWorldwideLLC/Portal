<%@page trimDirectiveWhitespaces="true"%>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@taglib prefix="botDetect" uri="https://captcha.com/java/jsp"%>
<%@page import="com.captcha.botdetect.web.servlet.Captcha"%>
<c:set var="language" value="${not empty param.language ? param.language : not empty language ? language : pageContext.request.locale}" scope="session" />
<fmt:setLocale value="${language}" />
<fmt:setBundle basename="com.warpww.web.i18n.register" />

<!DOCTYPE html>
<html>
    <head>
    		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>WARP Registration</title>
        <script src="jsx/util.js"></script>
    </head>
<body>
		<%@include  file="/htx/LanguageSelector.html" %>

        <form method="post" action="/com.warpww.web/register" enctype="multipart/form-data" name="registration" autocomplete="off">
        <div>
	  		<br><label><fmt:message key="register.label.username" /></label> 
			<input type="text" name="memberName" id="memberName" value=${param["memberName"]}>
	  		<label>Email Address:</label>
	  		<input type="text" name="emailAddress" id="emailAddress" value=${param["emailAddress"]}>
	  		<br/>
	  	  	<label>Passphrase:</label>
	  		<input type="password" name="passPhrase1" id="passPhrase1" value=${param["passPhrase"]}>
	  		<br>
	  		<label>Re-Enter Passphrase:</label>
	  		<input type="password" name="passPhrase2" id="passPhrase2" value=${param["passPhrase"]}>
	  		<br>
	  		<button type="button" onclick="toggleHide2('passPhrase1','passPhrase2')" id="passToggle">Show/Hide Passphrase</button>
	  		<br/>
  			<button type="submit" value="native" name="btnNative">Join WARP Now!</button>
  			<input type="hidden" value="default" name="captchaStatus">
  		
  		</div>
  		<br>
  		<br>
  		<div>
			<%
			  // Adding BotDetect Captcha to the page
			  Captcha captcha = Captcha.load(request, "exampleCaptcha");
			  captcha.setUserInputID("captchaCode");
			
			  String captchaHtml = captcha.getHtml();
			  out.write(captchaHtml);
			%>
			<input id="captchaCode" type="text" name="captchaCode" />
			<span class="incorrect">${messages.captchaIncorrect}</span>
			
		</div>
		<%
			System.out.println("TestPrint");
		  if ("POST".equalsIgnoreCase(request.getMethod())) {
		     // validate the Captcha to check we're not dealing with a bot
		     boolean isHuman = captcha.validate(request.getParameter("captchaCode"));
		   
		     if (isHuman) {
		      // Captcha validation passed, perform protected action
		    	 System.out.println("Passed");
		     } else {
		      // Captcha validation failed, show error message
		    	 System.out.println("Failed");
		     }
		  }
		%>
  		  

	</form>
</body>
</html>